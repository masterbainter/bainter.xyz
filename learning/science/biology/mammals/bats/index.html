<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The World of Bats: A 3D Evolutionary Journey</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c;
            color: #e2e8f0;
            overflow-x: hidden;
        }
        
        /* 3D Canvas Container */
        #canvas-container {
            position: relative;
            width: 100%;
            height: 500px;
            background-color: #111827;
            border-radius: 12px;
            cursor: grab;
        }
        #canvas-container:active {
            cursor: grabbing;
        }

        /* Labels for 3D nodes */
        .node-label {
            color: #e2e8f0;
            background: rgba(45, 55, 72, 0.8);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            pointer-events: none; /* Allows clicks to pass through to the 3D object */
            transition: all 0.2s ease;
        }

        .node-label.chiroptera {
             background: rgba(197, 48, 48, 0.9);
             color: white;
        }
        
        .info-card {
            background-color: #2d3748;
            border: 1px solid #4a5568;
            border-radius: 12px;
            padding: 24px;
            transition: all 0.3s ease;
        }
        .info-card h3 {
            color: #a3bffa;
        }
        
        .species-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .species-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        .external-link {
            transition: color 0.2s ease;
        }
        .external-link:hover {
            color: #a3bffa;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Main Container -->
    <div class="container mx-auto p-4 md:p-8">

        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-2">An Evolutionary Journey into the World of Bats</h1>
            <p class="text-lg text-gray-400">Discover the diversity of bats (Order: Chiroptera) and their place in the animal kingdom.</p>
        </header>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- Left Column: 3D Tree & Info -->
            <div class="lg:col-span-1 space-y-8">
                <div class="bg-gray-800 rounded-xl p-6 shadow-lg">
                    <h2 class="text-2xl font-bold mb-4 text-white">Where Do Bats Fit?</h2>
                    <p class="text-gray-400 mb-6">Explore the 3D mind map to see how bats are related to other mammals. Click and drag to rotate, scroll to zoom, and click a node to learn more.</p>
                    <div id="canvas-container"></div>
                </div>

                <!-- Information Display Card -->
                <div id="info-display" class="info-card hidden">
                    <h3 class="text-xl font-bold mb-2"></h3>
                    <p class="text-gray-300 mb-4"></p>
                    <div class="text-sm text-gray-400">
                        <strong>Examples:</strong> <span id="info-examples"></span>
                    </div>
                    <a href="#" id="info-link" target="_blank" rel="noopener noreferrer" class="inline-block mt-4 text-indigo-400 font-semibold hover:text-indigo-200 transition-colors">Learn More &rarr;</a>
                </div>
            </div>

            <!-- Right Column: Species Showcase -->
            <div class="lg:col-span-2">
                <h2 class="text-3xl font-bold mb-6 text-white text-center lg:text-left">Featured Bat Species</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Species cards remain the same as previous version -->
                    <div class="species-card bg-gray-800 rounded-xl overflow-hidden shadow-lg">
                        <img src="https://placehold.co/600x400/2d3748/e2e8f0?text=Vampire+Bat" 
                             onerror="this.onerror=null;this.src='https://placehold.co/600x400/2d3748/e2e8f0?text=Image+Not+Found';"
                             alt="Common Vampire Bat" class="w-full h-48 object-cover">
                        <div class="p-5">
                            <h3 class="text-xl font-bold text-red-400">Common Vampire Bat</h3>
                            <p class="text-sm italic text-gray-400 mb-3">Desmodus rotundus</p>
                            <p class="text-gray-300 mb-4">Famous for its unique diet of blood (sanguivory), this small bat uses infrared sensors to locate blood vessels on its prey.</p>
                            <a href="https://en.wikipedia.org/wiki/Common_vampire_bat" target="_blank" rel="noopener noreferrer" class="external-link font-medium text-gray-400">Explore on Wikipedia &raquo;</a>
                        </div>
                    </div>
                    <div class="species-card bg-gray-800 rounded-xl overflow-hidden shadow-lg">
                        <img src="https://placehold.co/600x400/2d3748/e2e8f0?text=Flying+Fox" 
                             onerror="this.onerror=null;this.src='https://placehold.co/600x400/2d3748/e2e8f0?text=Image+Not+Found';"
                             alt="Large Flying Fox" class="w-full h-48 object-cover">
                        <div class="p-5">
                            <h3 class="text-xl font-bold text-yellow-400">Large Flying Fox</h3>
                            <p class="text-sm italic text-gray-400 mb-3">Pteropus vampyrus</p>
                            <p class="text-gray-300 mb-4">One of the largest bat species, these "megabats" are frugivores (fruit-eaters) and do not use echolocation for navigation.</p>
                             <a href="https://en.wikipedia.org/wiki/Large_flying_fox" target="_blank" rel="noopener noreferrer" class="external-link font-medium text-gray-400">Explore on Wikipedia &raquo;</a>
                        </div>
                    </div>
                    <div class="species-card bg-gray-800 rounded-xl overflow-hidden shadow-lg">
                        <img src="https://placehold.co/600x400/2d3748/e2e8f0?text=Bumblebee+Bat" 
                             onerror="this.onerror=null;this.src='https://placehold.co/600x400/2d3748/e2e8f0?text=Image+Not+Found';"
                             alt="Bumblebee Bat" class="w-full h-48 object-cover">
                        <div class="p-5">
                            <h3 class="text-xl font-bold text-green-400">Bumblebee Bat</h3>
                            <p class="text-sm italic text-gray-400 mb-3">Craseonycteris thonglongyai</p>
                            <p class="text-gray-300 mb-4">Also known as Kitti's hog-nosed bat, this is arguably the world's smallest mammal, weighing less than a penny.</p>
                             <a href="https://en.wikipedia.org/wiki/Kitti%27s_hog-nosed_bat" target="_blank" rel="noopener noreferrer" class="external-link font-medium text-gray-400">Explore on Wikipedia &raquo;</a>
                        </div>
                    </div>
                    <div class="species-card bg-gray-800 rounded-xl overflow-hidden shadow-lg">
                        <img src="https://placehold.co/600x400/2d3748/e2e8f0?text=Hammer-headed+Bat" 
                             onerror="this.onerror=null;this.src='https://placehold.co/600x400/2d3748/e2e8f0?text=Image+Not+Found';"
                             alt="Hammer-headed Bat" class="w-full h-48 object-cover">
                        <div class="p-5">
                            <h3 class="text-xl font-bold text-blue-400">Hammer-headed Bat</h3>
                            <p class="text-sm italic text-gray-400 mb-3">Hypsignathus monstrosus</p>
                            <p class="text-gray-300 mb-4">Found in Africa, the males of this species have a very large, boxy head and produce loud, honking calls during mating rituals.</p>
                             <a href="https://en.wikipedia.org/wiki/Hammer-headed_bat" target="_blank" rel="noopener noreferrer" class="external-link font-medium text-gray-400">Explore on Wikipedia &raquo;</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Three.js and dependencies -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.165.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.165.0/examples/jsm/"
            }
        }
    </script>
    
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { CSS2DRenderer, CSS2DObject } from 'three/addons/renderers/CSS2DRenderer.js';

        // --- Data ---
        const infoData = {
            'laurasiatheria': { title: 'Superorder: Laurasiatheria', description: 'A large, diverse group of placental mammals believed to have originated on the northern supercontinent of Laurasia millions of years ago.', examples: 'Bats, Dogs, Whales, Horses, Hedgehogs', link: 'https://en.wikipedia.org/wiki/Laurasiatheria' },
            'eulipotyphla': { title: 'Order: Eulipotyphla', description: 'This group contains insectivorous mammals. They are considered to retain many features of the earliest placental mammals.', examples: 'Shrews, Moles, Hedgehogs', link: 'https://en.wikipedia.org/wiki/Eulipotyphla' },
            'scrotifera': { title: 'Clade: Scrotifera', description: 'A grouping that includes bats and their closest relatives among the Ferae and Euungulata.', examples: 'Bats, Carnivorans, Ungulates', link: 'https://en.wikipedia.org/wiki/Scrotifera' },
            'chiroptera': { title: 'Order: Chiroptera (Bats)', description: 'The only mammals capable of true and sustained flight. With over 1,400 species, they are the second-largest order of mammals.', examples: 'Vampire Bats, Flying Foxes', link: 'https://en.wikipedia.org/wiki/Bat' },
            'ferae': { title: 'Clade: Ferae', description: 'A clade that groups the orders Carnivora and Pholidota.', examples: 'Carnivorans, Pangolins', link: 'https://en.wikipedia.org/wiki/Ferae' },
            'pholidota': { title: 'Order: Pholidota', description: 'This order contains the pangolins, or scaly anteaters.', examples: 'Pangolins', link: 'https://en.wikipedia.org/wiki/Pangolin' },
            'carnivora': { title: 'Order: Carnivora', description: 'A diverse order of more than 280 species of placental mammals.', examples: 'Dogs, Cats, Bears, Seals', link: 'https://en.wikipedia.org/wiki/Carnivora' },
            'euungulata': { title: 'Clade: Euungulata', description: 'This group contains the true hoofed mammals.', examples: 'Horses, Cattle, Deer, Whales', link: 'https://en.wikipedia.org/wiki/Ungulate' },
            'perissodactyla': { title: 'Order: Perissodactyla', description: 'These are the odd-toed ungulates (hoofed mammals).', examples: 'Horses, Rhinoceroses, Tapirs', link: 'https://en.wikipedia.org/wiki/Perissodactyla' },
            'cetartiodactyla': { title: 'Order: Cetartiodactyla', description: 'This group combines the even-toed ungulates and the marine mammals.', examples: 'Cattle, Pigs, Deer, Whales', link: 'https://en.wikipedia.org/wiki/Cetartiodactyla' }
        };

        const treeData = {
            id: 'laurasiatheria',
            name: 'Laurasiatheria',
            children: [
                { id: 'eulipotyphla', name: 'Eulipotyphla' },
                {
                    id: 'scrotifera',
                    name: 'Scrotifera',
                    children: [
                        { id: 'chiroptera', name: 'Chiroptera (Bats)' },
                        {
                            id: 'ferae', name: 'Ferae',
                            children: [{ id: 'pholidota', name: 'Pholidota' }, { id: 'carnivora', name: 'Carnivora' }]
                        },
                        {
                            id: 'euungulata', name: 'Euungulata',
                            children: [{ id: 'perissodactyla', name: 'Perissodactyla' }, { id: 'cetartiodactyla', name: 'Cetartiodactyla' }]
                        }
                    ]
                }
            ]
        };

        // --- 3D Scene Setup ---
        let scene, camera, renderer, labelRenderer, controls;
        let raycaster, mouse;
        const clickableObjects = [];
        let selectedObject = null;
        
        const container = document.getElementById('canvas-container');

        // Materials
        const defaultMaterial = new THREE.MeshStandardMaterial({ color: 0x2d3748, roughness: 0.5 });
        const selectedMaterial = new THREE.MeshStandardMaterial({ color: 0x4c51bf, emissive: 0x4c51bf, emissiveIntensity: 0.5, roughness: 0.5 });
        const batMaterial = new THREE.MeshStandardMaterial({ color: 0xc53030, roughness: 0.5 });
        const batSelectedMaterial = new THREE.MeshStandardMaterial({ color: 0xe53e3e, emissive: 0xe53e3e, emissiveIntensity: 0.5, roughness: 0.5 });
        const lineMaterial = new THREE.LineBasicMaterial({ color: 0x4a5568 });

        function init() {
            // Scene
            scene = new THREE.Scene();
            
            // Camera
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.z = 15;

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setClearColor(0x111827);
            container.appendChild(renderer.domElement);

            // Label Renderer
            labelRenderer = new CSS2DRenderer();
            labelRenderer.setSize(container.clientWidth, container.clientHeight);
            labelRenderer.domElement.style.position = 'absolute';
            labelRenderer.domElement.style.top = '0px';
            container.appendChild(labelRenderer.domElement);

            // Controls
            controls = new OrbitControls(camera, labelRenderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 5;
            controls.maxDistance = 50;

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xcccccc, 1.5);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.8);
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);

            // Raycaster for interaction
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            // Build Mind Map
            createMindMap(treeData, new THREE.Vector3(0, 0, 0), 0);

            // Event Listeners
            window.addEventListener('resize', onWindowResize);
            container.addEventListener('click', onClick);
        }

        function createMindMap(nodeData, parentPosition, level) {
            // Create the 3D sphere for the node
            const geometry = new THREE.SphereGeometry(1, 32, 16);
            const isBatNode = nodeData.id === 'chiroptera';
            const material = isBatNode ? batMaterial : defaultMaterial;
            const sphere = new THREE.Mesh(geometry, material);
            
            // Set user data for identification
            sphere.userData = { id: nodeData.id };
            
            // Create the HTML label for the node
            const labelDiv = document.createElement('div');
            labelDiv.className = 'node-label';
            if(isBatNode) labelDiv.classList.add('chiroptera');
            labelDiv.textContent = nodeData.name;
            const label = new CSS2DObject(labelDiv);
            label.position.set(0, 1.3, 0); // Position label above the sphere
            sphere.add(label);
            
            scene.add(sphere);
            clickableObjects.push(sphere);

            if (nodeData.children) {
                const angleStep = (Math.PI * 2) / nodeData.children.length;
                const radius = 3 + level * 2.5;
                
                nodeData.children.forEach((childNode, index) => {
                    const angle = index * angleStep;
                    const childPosition = new THREE.Vector3(
                        parentPosition.x + Math.cos(angle) * radius,
                        parentPosition.y + Math.sin(angle) * radius,
                        parentPosition.z - 3 // push children back in Z
                    );
                    sphere.position.copy(parentPosition);

                    // Create line connecting parent to child
                    const points = [parentPosition, childPosition];
                    const lineGeometry = new THREE.BufferGeometry().setFromPoints(points);
                    const line = new THREE.Line(lineGeometry, lineMaterial);
                    scene.add(line);
                    
                    // Recurse for children
                    createMindMap(childNode, childPosition, level + 1);
                });
            } else {
                 sphere.position.copy(parentPosition);
            }
        }
        
        function updateInfoCard(nodeId) {
            const infoDisplay = document.getElementById('info-display');
            const data = infoData[nodeId];
            if (data) {
                infoDisplay.querySelector('h3').textContent = data.title;
                infoDisplay.querySelector('p').textContent = data.description;
                infoDisplay.querySelector('#info-examples').textContent = data.examples;
                const link = infoDisplay.querySelector('#info-link');
                link.href = data.link;
                link.style.display = data.link ? 'inline-block' : 'none';
                infoDisplay.classList.remove('hidden');
            }
        }

        function onClick(event) {
            event.preventDefault();

            const rect = renderer.domElement.getBoundingClientRect();
            mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
            
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(clickableObjects);

            if (intersects.length > 0) {
                const newSelected = intersects[0].object;
                
                // Deselect previous object
                if (selectedObject) {
                    selectedObject.material = selectedObject.userData.id === 'chiroptera' ? batMaterial : defaultMaterial;
                }
                
                // Select new object
                selectedObject = newSelected;
                selectedObject.material = selectedObject.userData.id === 'chiroptera' ? batSelectedMaterial : selectedMaterial;
                
                // Update the info card
                updateInfoCard(selectedObject.userData.id);
            }
        }

        function onWindowResize() {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
            labelRenderer.setSize(container.clientWidth, container.clientHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
            labelRenderer.render(scene, camera);
        }

        init();
        animate();
    </script>
</body>
</html>
